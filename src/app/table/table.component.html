<app-topbar class="mb-6"></app-topbar>

<div class="card mr-8 ml-8 mb-8 shadow-xl" style="margin-top: 75px; background-color: rgba(255, 255, 255, 0.591)">
  <p-table
    #dt2
    [value]="products"
    dataKey="id"
    [tableStyle]="{ 'min-width': '60rem' }"
    showGridlines
    [globalFilterFields]="['proceso_contratacion', 'country.proceso_contratacion', 'representative.proceso_contratacion', 'status']"
  >
    <ng-template #caption>
      <div class="container mx-auto p-4">  <div class="flex flex-col md:flex-row md:items-center md:justify-between"> <div>
        <h2><b>Consultando Listado de Procesos</b></h2>
      </div>
    <div class="flex flex-wrap justify-end gap-2 mt-4 md:mt-0"> <p-iconfield iconPosition="left" class="ml-auto w-full md:w-auto"> <p-inputicon>
          <i class="pi pi-search"></i>
        </p-inputicon>
        <input
          pInputText
          type="text"
          (input)="onGlobalFilter(dt2, $event)"
          placeholder="Buscar Proceso"
          class="w-full md:w-auto"  />
      </p-iconfield>
    </div>
  </div>
</div>
    </ng-template>
    <ng-template #header>
      <tr>
        <th>Proceso de Contratación</th>
        <th>Archivos</th>
        <th>Descripción</th>
        <th>Total de Partidas</th>
      </tr>
    </ng-template>
    <ng-template #body let-product let-expanded="expanded">
      <tr>
        <td style="text-align: center;">
          <p-button
            severity="info"
            (onClick)="filtrarProductos(product)"
            class="mt-2 "
            (click)="showDialog(filteredProducts)"
          >
            {{ product.proceso_contratacion }}
          </p-button>
        </td>
        <td style="text-align: center;">
          <p-button
            severity="danger"
            class="mt-2"
            (onClick)="archivo(product.proceso_contratacion)"
          >
            Ver
          </p-button>
        </td>
        <td>{{ product.descripcion_corta_nombre_contrato }}</td>
        <td style="text-align: right;">{{ product.no_partida }}</td>
      </tr>
    </ng-template>
    <ng-template #expandedrow let-product>
      <tr>
        <td colspan="7">
          <div class="p-4">
            <h5>Ordenando por {{ product.proceso_contratacion }}</h5>
              <p-multiselect
                class="mb-9"
                display="chip"
                [options]="cols"
                [(ngModel)]="selectedColumns"
                optionLabel="header"
                selectedItemsLabel="{0} columns selected"
                [style]="{ 'min-width': '200px' }"
                placeholder="Choose Columns"
              />
              <p-button
                (onClick)="archivo(product.proceso_contratacion)"
                class="ml-8"
                (click)="showDialog(filteredProducts)"
                >VER ARCHIVOS - {{ product.proceso_contratacion }}</p-button
              >
              <p-table
                stripedRows
                class="shadow-lg"
                [value]="filteredProducts"
                [columns]="selectedColumns"
                scrollable="true"
                [style]="{ width: '1725px' }"
                scrollHeight="400px"
                showGridlines
                [resizableColumns]="true"
                [columns]="cols"
                [reorderableColumns]="true"
              >
                <ng-template #header>
                  <tr>
                    <th
                      *ngFor="let col of selectedColumns"
                      pResizableColumn
                      pReorderableColumn
                    >
                      {{ col.header }}
                    </th>
                  </tr>
                </ng-template>
                <ng-template #body let-item>
                  <tr>
                    <td *ngFor="let col of selectedColumns">
                      {{ item[col.field] || "- Sin información -" }}
                    </td>
                  </tr>
                </ng-template>
              </p-table>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog
  header="Procesos de Contratación"
  [modal]="true"
  [(visible)]="visible"
  [style]="{ width: '100rem', height: '100rem' }"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
  [maximizable]="true"
>
  <p-multiselect
    class="mb-9"
    display="chip"
    [options]="cols"
    [(ngModel)]="selectedColumns"
    optionLabel="header"
    selectedItemsLabel="{0} columns selected"
    [style]="{ 'min-width': '200px' }"
    placeholder="Choose Columns"
  />
  <div class="flex justify-center items-center">
    <p-table
      stripedRows
      [value]="filteredProducts"
      [columns]="selectedColumns"
      scrollable="true"
      [style]="{ width: '1360px' }"
      scrollHeight="650px"
      showGridlines
      [resizableColumns]="true"
      [columns]="cols"
      [reorderableColumns]="true"
    >
      <ng-template #header>
        <tr>
          <th
            *ngFor="let col of selectedColumns"
            pResizableColumn
            pReorderableColumn
          >
            {{ col.header }}
          </th>
        </tr>
      </ng-template>
      <ng-template #body let-item>
        <tr>
          <td *ngFor="let col of selectedColumns">
            {{ item[col.field] || "- Sin información -" }}
          </td>
          </tr>
      </ng-template>
    </p-table>
  </div>
</p-dialog>

<p-dialog
  header="Archivos"
  [modal]="true"
  [(visible)]="visible2"
  [style]="{ width: '75vw', height: '80vh' }"
  [breakpoints]="{ '1199px': '90vw', '575px': '95vw' }"
  [maximizable]="true"
>

  <p-carousel [value]="pdfs" [numVisible]="3" [numScroll]="3" [circular]="false" [responsiveOptions]="responsiveOptions" autoplayInterval="3000">
      <ng-template let-pdf #item>
          <div class="border border-surface rounded-border m-2 p-4">
              <div class="mb-4">
                  <div class="relative mx-auto">
                      <iframe [src]="pdf.url" type="application/pdf"></iframe>
                  </div>
              </div>
              <div class="mb-4 font-medium">{{ pdf.nombre }}</div>
              <div class="flex justify-between items-center">
                  <span>
                      <a [href]="pdf.url" target="_blank"><p-button icon="pi pi-download" severity="secondary" [outlined]="true" /></a>
                  </span>
              </div>
          </div>
      </ng-template>
  </p-carousel>
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-6">
    <p-card *ngFor="let archivo of archivosDescargables" header="{{ archivo.nombre }}" class="col-span-1">
      <div class="p-4">
        <p-button
          label="Descargar"
          icon="pi pi-download"
          (onClick)="descargarArchivo(archivo.url)"
          class="p-button-rounded"
        ></p-button>
      </div>
    </p-card>
  </div>
</p-dialog>


<p-dialog header="información" [modal]="true" [(visible)]="visible3" [style]="{ width: '50rem' }" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }">
    <p>
        Archivos no encontrados
    </p>
</p-dialog>

